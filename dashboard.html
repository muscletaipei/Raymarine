<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluetooth LED Control</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5 text-center">
        <h1>Bluetooth LED Controller</h1>
        <button id="connectButton" class="btn btn-primary">ğŸ”— Connect</button>
        <button id="toggleLedButton" class="btn btn-success" disabled>ğŸ’¡ Toggle LED</button>
        <p id="status" class="mt-3">Status: Disconnected</p>
    </div>

    <script>
        let device;
        let characteristic;
        const LED_SERVICE_UUID = '0000ffe0-0000-1000-8000-00805f9b34fb'; // ä½ çš„ BLE æœå‹™ UUID
        const LED_CHARACTERISTIC_UUID = '0000ffe1-0000-1000-8000-00805f9b34fb'; // æ§åˆ¶ LED çš„ç‰¹å¾µå€¼ UUID

        document.getElementById('connectButton').addEventListener('click', async () => {
            try {
                console.log("ğŸ” æœå°‹è—ç‰™è£ç½®...");
                device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: [LED_SERVICE_UUID]
                });

                console.log("ğŸ”— é€£æ¥è‡³è£ç½®:", device.name);
                document.getElementById('status').textContent = `Status: Connecting...`;
                const server = await device.gatt.connect();
                
                console.log("ğŸ“¡ ç²å– GATT æœå‹™...");
                const service = await server.getPrimaryService(LED_SERVICE_UUID);
                
                console.log("ğŸ’¾ ç²å– LED ç‰¹å¾µå€¼...");
                characteristic = await service.getCharacteristic(LED_CHARACTERISTIC_UUID);

                document.getElementById('status').textContent = `Status: Connected to ${device.name}`;
                document.getElementById('toggleLedButton').disabled = false;

            } catch (error) {
                console.error("âš ï¸ é€£ç·šéŒ¯èª¤:", error);
                document.getElementById('status').textContent = `Status: Connection Failed`;
            }
        });

        document.getElementById('toggleLedButton').addEventListener('click', async () => {
            if (!characteristic) {
                console.error("âš ï¸ è«‹å…ˆé€£æ¥è—ç‰™è£ç½®ï¼");
                return;
            }

            try {
                let command = new Uint8Array([1]); // 1 = é–‹ç‡ˆ, 0 = é—œç‡ˆ
                await characteristic.writeValue(command);
                console.log("âœ… LED é–‹å•Ÿ");

                setTimeout(async () => {
                    let offCommand = new Uint8Array([0]);
                    await characteristic.writeValue(offCommand);
                    console.log("ğŸš« LED é—œé–‰");
                }, 3000); // 3 ç§’å¾Œé—œé–‰ LED

            } catch (error) {
                console.error("âŒ ç„¡æ³•å¯«å…¥æ•¸æ“š:", error);
            }
        });
    </script>
</body>
</html>