<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluetooth LED Control</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5 text-center">
        <h1>Bluetooth LED Controller</h1>
        <button id="connectButton" class="btn btn-primary">🔗 Connect</button>
        <button id="toggleLedButton" class="btn btn-success" disabled>💡 Toggle LED</button>
        <p id="status" class="mt-3">Status: Disconnected</p>
    </div>

    <script>
        let device;
        let characteristic;
        const LED_SERVICE_UUID = '0000ffe0-0000-1000-8000-00805f9b34fb'; // 你的 BLE 服務 UUID
        const LED_CHARACTERISTIC_UUID = '0000ffe1-0000-1000-8000-00805f9b34fb'; // 控制 LED 的特徵值 UUID

        document.getElementById('connectButton').addEventListener('click', async () => {
            try {
                console.log("🔍 搜尋藍牙裝置...");
                device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: [LED_SERVICE_UUID]
                });

                console.log("🔗 連接至裝置:", device.name);
                document.getElementById('status').textContent = `Status: Connecting...`;
                const server = await device.gatt.connect();
                
                console.log("📡 獲取 GATT 服務...");
                const service = await server.getPrimaryService(LED_SERVICE_UUID);
                
                console.log("💾 獲取 LED 特徵值...");
                characteristic = await service.getCharacteristic(LED_CHARACTERISTIC_UUID);

                document.getElementById('status').textContent = `Status: Connected to ${device.name}`;
                document.getElementById('toggleLedButton').disabled = false;

            } catch (error) {
                console.error("⚠️ 連線錯誤:", error);
                document.getElementById('status').textContent = `Status: Connection Failed`;
            }
        });

        document.getElementById('toggleLedButton').addEventListener('click', async () => {
            if (!characteristic) {
                console.error("⚠️ 請先連接藍牙裝置！");
                return;
            }

            try {
                let command = new Uint8Array([1]); // 1 = 開燈, 0 = 關燈
                await characteristic.writeValue(command);
                console.log("✅ LED 開啟");

                setTimeout(async () => {
                    let offCommand = new Uint8Array([0]);
                    await characteristic.writeValue(offCommand);
                    console.log("🚫 LED 關閉");
                }, 3000); // 3 秒後關閉 LED

            } catch (error) {
                console.error("❌ 無法寫入數據:", error);
            }
        });
    </script>
</body>
</html>